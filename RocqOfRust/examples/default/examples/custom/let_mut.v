(* Generated by rocq-of-rust *)
Require Import RocqOfRust.RocqOfRust.

(*
fn let_mut() -> i32 {
  let mut x = 5;
  x = x + 1;
  x
}
*)
Definition let_mut (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
  match ε, τ, α with
  | [], [], [] =>
    ltac:(M.monadic
      (M.read (|
        let~ x : Ty.path "i32" := Value.Integer IntegerKind.I32 5 in
        let~ _ : Ty.tuple [] :=
          M.write (|
            x,
            M.call_closure (|
              Ty.path "i32",
              BinOp.Wrap.add,
              [ M.read (| x |); Value.Integer IntegerKind.I32 1 ]
            |)
          |) in
        x
      |)))
  | _, _, _ => M.impossible "wrong number of arguments"
  end.

Global Instance Instance_IsFunction_let_mut : M.IsFunction.C "let_mut::let_mut" let_mut.
Admitted.
Global Typeclasses Opaque let_mut.

(*
fn match_mut() -> i32 {
  let Some(mut x) = Some(5) else {
    return 0;
  };
  x = x + 1;
  x
}
*)
Definition match_mut (ε : list Value.t) (τ : list Ty.t) (α : list Value.t) : M :=
  match ε, τ, α with
  | [], [], [] =>
    ltac:(M.monadic
      (M.catch_return (Ty.path "i32") (|
        ltac:(M.monadic
          (M.match_operator (|
            Ty.path "i32",
            M.alloc (|
              Ty.apply (Ty.path "core::option::Option") [] [ Ty.path "i32" ],
              Value.StructTuple
                "core::option::Option::Some"
                []
                [ Ty.path "i32" ]
                [ Value.Integer IntegerKind.I32 5 ]
            |),
            [
              fun γ =>
                ltac:(M.monadic
                  (let γ0_0 :=
                    M.SubPointer.get_struct_tuple_field (| γ, "core::option::Option::Some", 0 |) in
                  let x := M.copy (| Ty.path "i32", γ0_0 |) in
                  M.read (|
                    let~ _ : Ty.tuple [] :=
                      M.write (|
                        x,
                        M.call_closure (|
                          Ty.path "i32",
                          BinOp.Wrap.add,
                          [ M.read (| x |); Value.Integer IntegerKind.I32 1 ]
                        |)
                      |) in
                    x
                  |)));
              fun γ =>
                ltac:(M.monadic (M.read (| M.return_ (| Value.Integer IntegerKind.I32 0 |) |)))
            ]
          |)))
      |)))
  | _, _, _ => M.impossible "wrong number of arguments"
  end.

Global Instance Instance_IsFunction_match_mut : M.IsFunction.C "let_mut::match_mut" match_mut.
Admitted.
Global Typeclasses Opaque match_mut.
